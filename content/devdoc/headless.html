<?xml version="1.0" encoding="ISO-8859-1" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
  <meta name="LastChangedDate" content="$LastChangedDate$" />
  <meta name="Revision" content="$Revision$" />
  <meta name="HeadURL" content="$HeadURL$" />
  <link rel="stylesheet" href="../book.css" charset="ISO-8859-1" type="text/css" />
  <title>Headless Code Coverage for Equinox</title>
</head>

<body>

<p class="warn">
  This extension to Equinox integrates the EMMA code coverage library into
  OSGi/Equinox applications. Please also consider our new code coverage library
  <a href="../jacoco/index.html">JaCoCo</a> which greatly simplifies the
  integration as it provides on-the-fly coverage data recording for any Java
  application (including OSGi frameworks).
</p>

<h1>Headless Code Coverage for Equinox</h1>

<p>
  EclEmma is a user interface centric tool implemented for and on top of the Eclipse IDE.
  EclEmma also provides support for code coverage analysis of Eclipse applications itself,
  e.g. for JUnit plug-in tests. While a code coverage tool within the IDE supports the
  individual developer with his/her daily work, so called <i>headless</i> tools are
  required for testing in automated environments like (continuous) build systems. Based
  on the techniques described in <a href="../research/instrumentingosgi/index.html">this paper</a>
  the <i>EclEmma Equinox Runtime</i> easily adds code coverage to any Java application running
  on OSGi/Equinox.
</p>


<h2>Features</h2>

<p>
  The <i>EclEmma Equinox Runtime</i> is a single plug-in that can be added to any Eclipse
  application and provides code coverage information for the executed Java code. It has
  several configuration options e.g. for selecting the plug-ins to analyze.
</p>

<h3>How does it work?</h3>

<p>
  The <i>EclEmma Equinox Runtime</i> is a so called OSGi framework extension that uses
  specific hooks of the Equinox OSGi implementation to dynamically instrument plug-in
  classes using the <a class="extern" href="http://emma.sourceforge.net/">EMMA</a> code
  coverage library. 
</p>

<h2>Usage</h2>

<h3>System Requirements</h3>

<p>
  The <i>EclEmma Code Coverage for Equinox</i> runtime requires Eclipse 3.2 or
  higher and Java 1.4 or higher. As Eclipse/Equinox changed some internal APIs
  with 3.5, you need to select from different extension versions:
</p>

<ul>
  <li>Eclipse 3.2, 3.3, 3.4 &rarr; org.eclemma.runtime.equinox 1.0.0</li>
  <li>Eclipse 3.5 and later &rarr; org.eclemma.runtime.equinox 1.1.0</li>
</ul>


<h3>Headless Mode</h3>

<p>
  This will be the typical scenario when you run you plug-in tests in your
  automated build. 
</p>

<ul>
  <li>Download the latest version of the compiled bundle
    <code>org.eclemma.runtime.equinox</code> from the
    <a class="extern" href="https://sourceforge.net/projects/eclemma/files/06_EclEmma_Runtime_for_Equinox/">SF download page</a>.</li>
  <li>Unzip the file in your Eclipse installation root. The expanded bundle
    <code>org.eclemma.runtime.equinox</code> has to be located in the <code>plugins</code>
    folder. This must be the same directory  where the <code>org.eclipse.osgi</code>
    bundle is located. Using e.g. an extension site will not work! The
    <code>org.eclemma.runtime.equinox</code> must not be jared, as it contains another JAR
    which can not be loaded from a packaged bundles in case of framework extensions.
    </li>
  <li>Insert the following line into the <code>./configuration/config.ini</code>
    file of your target Eclipse:
    <pre>osgi.framework.extensions=org.eclemma.runtime.equinox</pre>
    or add the same value as a Java system property using the <code>-D</code>
    parameter.</li>
</ul>

<h3>PDE Mode</h3>

<p>
  If you want to study or modify the extension bundle you may directly import
  it to your PDE workspace and launch a Eclipse application in development mode.
  The extension works for any OSGi/Equinox based launch type, i.e. Eclipse
  application OSGi framework and JUnit plug-in test.
</p>

<ul>
  <li>Import the latest version of the extension bundle from the SVN repository at
    <code>https://eclemma.svn.sourceforge.net/svnroot/eclemma/eclemma/trunk/org.eclemma.runtime.equinox</code>.</li>
  <li>Due to the fact that Equinox needs any framework extension co-located with
    the OSGi framework bundle you need to also import <code>org.eclipse.osgi</code>
    into your workspace (from the <i>Plug-Ins</i> view's context menu select
    <i>Import As</i> &rarr; <i>Source Project</i>).</li>
  <li>Take a existing launch configuration or create a new one. Make sure that
    the <code>org.eclemma.runtime.equinox</code> and the 
    <code>org.eclipse.osgi</code> bundle are enabled.</li>
  <li>On the <i>Arguments</i> tab insert the following definition in the
    <i>VM arguments</i> field:
    <pre>-Dosgi.framework.extensions=org.eclemma.runtime.equinox</pre></li>
</ul>

<h3>Configuration Options</h3>

<p>
  All configuration options are given by system properties. They can be passed into the
  JVM with the <code>-D</code> parameter. For example
</p>
<pre>
  -Demma.session.out.file=testcoverage.es
</pre>
<p>
  will set the property <code>emma.session.out.file</code> to the value 
  <code>testcoverage.es</code>. Note that the <i>EclEmma Equinox Runtime</i> will produce
  default results without any configuration options.
</p>

<ul>
  <li><b><code>eclemma.help</code></b><br/>
    Setting any value to this property prints help information to the console.</li>
  <li><b><code>eclemma.instrument.bundles</code></b><br/>
    Comma separated list of bundle ids that should be considered for code coverage analysis.
    Default: All bundles.</li>
  <li><b><code>emma.session.out.file</code></b><br/>
    Location of the EMMA session file where the coverage information will be written to.
    Default: <code>coverage.es</code> in the working directory.</li>
  <li><b><code>emma.session.out.merge</code></b><br/>
    If set to <code>true</code> the result will be merged with an existing coverage session
    file. Default: Merge with existing file.</li>
  <li><b><code>emma.filter</code></b><br/>
    Comma separated list of filters for class names that should be considered for code
    coverage analysis. The usual wildcards <code>*</code> and <code>?</code> are possible,
    a optional <code>+</code> or <code>-</code> prefix indicates inclusion or exclusion.
    See <a class="extern" href="http://emma.sourceforge.net/reference_single/reference.html#instrset.filters">Emma documentation</a>
    for details. Default: All classes in the selected bundles.
  </li>
</ul>


<h3>Analyzing the Coverage Result</h3>

<p>
  The code coverage runtime create a single <i>EMMA coverage session</i> file
  containing Meta data about all the classes of the bundles under test and the
  actual coverage information. This file can be
  <a href="../userdoc/importexport.html">imported into EclEmma</a> and analyzed
  within Eclipse. Alternatively a HTML report can be created using
  <a class="extern" href="http://emma.sourceforge.net/reference/ch02s04.html">EMMA's Ant task</a>. 
</p>

<p>
  In both cases several coverage session files from different launches can be
  merged into a single report.
</p>

<h2>Acknowledgment</h2>

<p>
  The <i>EclEmma Equinox Runtime</i> has been contributed and is maintained by
  Mikkel T Andersen. Any questions and comments about the project are welcome
  in our <a href="../support.html">forums</a>.  
</p>

</body>
</html>